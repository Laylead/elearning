<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyHub Â· Register</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .register-container {
      background: white;
      border-radius: 32px;
      padding: 48px 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 30px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      font-size: 36px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 32px;
    }

    .logo span {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    h2 {
      color: #1e293b;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
    }

    .subtitle {
      color: #64748b;
      text-align: center;
      margin-bottom: 32px;
    }

    /* Step Tracker */
    .step-tracker {
      display: flex;
      justify-content: space-between;
      margin-bottom: 48px;
      position: relative;
    }

    .step-tracker::before {
      content: '';
      position: absolute;
      top: 24px;
      left: 0;
      right: 0;
      height: 4px;
      background: #e2e8f0;
      z-index: 1;
    }

    .step-item {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .step-number {
      width: 48px;
      height: 48px;
      background: white;
      border: 4px solid #e2e8f0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #64748b;
      background: white;
      transition: all 0.3s;
      margin-bottom: 8px;
    }

    .step-label {
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .step-item.active .step-number {
      background: #6366f1;
      border-color: #6366f1;
      color: white;
      transform: scale(1.1);
      box-shadow: 0 10px 20px -5px #6366f1;
    }

    .step-item.active .step-label {
      color: #6366f1;
      font-weight: 700;
    }

    .step-item.completed .step-number {
      background: #10b981;
      border-color: #10b981;
      color: white;
    }

    .step-item.completed .step-number i {
      font-size: 20px;
    }

    /* Form Sections */
    .form-section {
      display: none;
      animation: fadeIn 0.5s ease-out;
    }

    .form-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .input-group {
      margin-bottom: 24px;
    }

    .input-label {
      display: block;
      color: #475569;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .input-field {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      font-size: 16px;
      transition: all 0.2s;
      background: #f8fafc;
    }

    .input-field:focus {
      outline: none;
      border-color: #6366f1;
      background: white;
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    select.input-field {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 20px center;
      background-size: 16px;
    }

    .password-input-wrapper {
      position: relative;
    }

    .toggle-password {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #94a3b8;
    }

    /* Level Selector */
    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
    }

    .level-option {
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      padding: 16px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .level-option:hover {
      border-color: #6366f1;
      background: #f0f4ff;
    }

    .level-option.selected {
      background: #6366f1;
      border-color: #6366f1;
      color: white;
      transform: scale(1.02);
      box-shadow: 0 10px 20px -8px #6366f1;
    }

    .level-option .level-number {
      font-weight: 700;
      font-size: 24px;
      margin-bottom: 4px;
    }

    .level-option .level-text {
      font-size: 12px;
      font-weight: 500;
    }

    /* Review Card */
    .review-card {
      background: #f8fafc;
      border-radius: 24px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .review-item {
      display: flex;
      justify-content: space-between;
      padding: 16px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .review-item:last-child {
      border-bottom: none;
    }

    .review-label {
      color: #64748b;
      font-weight: 500;
    }

    .review-value {
      font-weight: 600;
      color: #1e293b;
      text-align: right;
    }

    .edit-btn {
      color: #6366f1;
      background: none;
      border: none;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }

    .edit-btn:hover {
      text-decoration: underline;
    }

    /* Navigation Buttons */
    .button-group {
      display: flex;
      gap: 16px;
      margin-top: 32px;
    }

    .btn {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #6366f1;
      color: white;
      box-shadow: 0 10px 20px -8px #6366f1;
    }

    .btn-primary:hover {
      background: #4f52e0;
      transform: translateY(-2px);
      box-shadow: 0 15px 30px -8px #6366f1;
    }

    .btn-secondary {
      background: #f1f4f9;
      color: #475569;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .error-message {
      background: #fee2e2;
      color: #ef4444;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    /* University search */
    .university-search {
      position: relative;
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid #e2e8f0;
      border-top: none;
      border-radius: 0 0 16px 16px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
    }

    .search-results.show {
      display: block;
    }

    .search-result-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .search-result-item:hover {
      background: #f1f4f9;
    }

    .department-select {
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="register-container">
    <div class="logo">Study<span>Hub</span></div>
    <h2>Create Account</h2>
    <p class="subtitle">Join your university study community</p>

    <!-- Step Tracker -->
    <div class="step-tracker">
      <div class="step-item active" id="step1">
        <div class="step-number">1</div>
        <span class="step-label">Account</span>
      </div>
      <div class="step-item" id="step2">
        <div class="step-number">2</div>
        <span class="step-label">University</span>
      </div>
      <div class="step-item" id="step3">
        <div class="step-number">3</div>
        <span class="step-label">Department</span>
      </div>
      <div class="step-item" id="step4">
        <div class="step-number">4</div>
        <span class="step-label">Level</span>
      </div>
      <div class="step-item" id="step5">
        <div class="step-number">5</div>
        <span class="step-label">Review</span>
      </div>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <!-- Step 1: Account Information -->
    <div class="form-section active" id="section1">
      <form id="step1Form">
        <div class="input-group">
          <label class="input-label">Full Name</label>
          <input type="text" class="input-field" id="fullName" placeholder="Enter your full name" required>
        </div>

        <div class="input-group">
          <label class="input-label">Email</label>
          <input type="email" class="input-field" id="email" placeholder="Enter your email" required>
        </div>

        <div class="input-group">
          <label class="input-label">Password</label>
          <div class="password-input-wrapper">
            <input type="password" class="input-field" id="password" placeholder="Create a password" required>
            <i class="fas fa-eye toggle-password" id="togglePassword"></i>
          </div>
          <p style="font-size: 12px; color: #64748b; margin-top: 4px;">Minimum 6 characters</p>
        </div>

        <div class="input-group">
          <label class="input-label">Confirm Password</label>
          <div class="password-input-wrapper">
            <input type="password" class="input-field" id="confirmPassword" placeholder="Confirm your password" required>
            <i class="fas fa-eye toggle-password" id="toggleConfirmPassword"></i>
          </div>
        </div>

        <div class="button-group">
          <button type="button" class="btn btn-primary" id="nextToUniversity">Continue <i class="fas fa-arrow-right"></i></button>
        </div>
      </form>
    </div>

    <!-- Step 2: Select University -->
    <div class="form-section" id="section2">
      <div class="input-group university-search">
        <label class="input-label">Search for your university</label>
        <input type="text" class="input-field" id="universitySearch" placeholder="Type to search universities..." autocomplete="off">
        <div class="search-results" id="searchResults"></div>
      </div>

      <div class="input-group">
        <label class="input-label">Or select from popular universities</label>
        <select class="input-field" id="popularUniversities">
          <option value="">Choose a university</option>
          <option value="University of Lagos">University of Lagos (UNILAG)</option>
          <option value="Obafemi Awolowo University">Obafemi Awolowo University (OAU)</option>
          <option value="University of Ibadan">University of Ibadan (UI)</option>
          <option value="Ahmadu Bello University">Ahmadu Bello University (ABU)</option>
          <option value="University of Nigeria Nsukka">University of Nigeria Nsukka (UNN)</option>
        </select>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" id="backToAccount"><i class="fas fa-arrow-left"></i> Back</button>
        <button type="button" class="btn btn-primary" id="nextToDepartment">Continue <i class="fas fa-arrow-right"></i></button>
      </div>
    </div>

    <!-- Step 3: Select Department -->
    <div class="form-section" id="section3">
      <div class="input-group">
        <label class="input-label">Select your department</label>
        <select class="input-field department-select" id="department">
          <option value="">Choose department</option>
          <option value="Computer Science">Computer Science</option>
          <option value="Engineering">Engineering</option>
          <option value="Medicine">Medicine</option>
          <option value="Business Administration">Business Administration</option>
          <option value="Law">Law</option>
          <option value="Pharmacy">Pharmacy</option>
          <option value="Nursing">Nursing</option>
          <option value="Economics">Economics</option>
          <option value="Mass Communication">Mass Communication</option>
          <option value="Architecture">Architecture</option>
        </select>
      </div>

      <div class="input-group">
        <label class="input-label">Matriculation Number (Optional)</label>
        <input type="text" class="input-field" id="matricNo" placeholder="e.g., 2023/001">
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" id="backToUniversity"><i class="fas fa-arrow-left"></i> Back</button>
        <button type="button" class="btn btn-primary" id="nextToLevel">Continue <i class="fas fa-arrow-right"></i></button>
      </div>
    </div>

    <!-- Step 4: Select Level -->
    <div class="form-section" id="section4">
      <div class="input-group">
        <label class="input-label">Current Level of Study</label>
        <div class="level-grid" id="levelGrid">
          <div class="level-option" data-level="100">
            <div class="level-number">100</div>
            <div class="level-text">Freshman</div>
          </div>
          <div class="level-option" data-level="200">
            <div class="level-number">200</div>
            <div class="level-text">Sophomore</div>
          </div>
          <div class="level-option" data-level="300">
            <div class="level-number">300</div>
            <div class="level-text">Junior</div>
          </div>
          <div class="level-option" data-level="400">
            <div class="level-number">400</div>
            <div class="level-text">Senior</div>
          </div>
          <div class="level-option" data-level="500">
            <div class="level-number">500</div>
            <div class="level-text">Graduate</div>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" id="backToDepartment"><i class="fas fa-arrow-left"></i> Back</button>
        <button type="button" class="btn btn-primary" id="nextToReview">Review <i class="fas fa-arrow-right"></i></button>
      </div>
    </div>

    <!-- Step 5: Review Information -->
    <div class="form-section" id="section5">
      <div class="review-card">
        <div class="review-item">
          <span class="review-label">Full Name</span>
          <span class="review-value" id="reviewName">-</span>
          <button class="edit-btn" onclick="goToStep(1)">Edit</button>
        </div>
        <div class="review-item">
          <span class="review-label">Email</span>
          <span class="review-value" id="reviewEmail">-</span>
          <button class="edit-btn" onclick="goToStep(1)">Edit</button>
        </div>
        <div class="review-item">
          <span class="review-label">University</span>
          <span class="review-value" id="reviewUniversity">-</span>
          <button class="edit-btn" onclick="goToStep(2)">Edit</button>
        </div>
        <div class="review-item">
          <span class="review-label">Department</span>
          <span class="review-value" id="reviewDepartment">-</span>
          <button class="edit-btn" onclick="goToStep(3)">Edit</button>
        </div>
        <div class="review-item">
          <span class="review-label">Matric No.</span>
          <span class="review-value" id="reviewMatric">-</span>
          <button class="edit-btn" onclick="goToStep(3)">Edit</button>
        </div>
        <div class="review-item">
          <span class="review-label">Current Level</span>
          <span class="review-value" id="reviewLevel">-</span>
          <button class="edit-btn" onclick="goToStep(4)">Edit</button>
        </div>
      </div>

      <div class="terms-checkbox" style="margin: 24px 0;">
        <input type="checkbox" id="terms" required>
        <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" id="backToLevel"><i class="fas fa-arrow-left"></i> Back</button>
        <button type="button" class="btn btn-primary" id="submitRegistration">
          <span id="btnText">Create Account</span>
          <span id="btnLoader" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    (function() {
      // Check Firebase
      if (typeof firebase === 'undefined' || !firebase.apps.length) {
        alert('Firebase not initialized. Check your configuration.');
        return;
      }

      const auth = firebase.auth();
      const db = firebase.firestore();

      // State management
      let currentStep = 1;
      let userData = {
        fullName: '',
        email: '',
        password: '',
        university: '',
        department: '',
        matricNo: '',
        level: ''
      };

      // University database (simulated)
      const universities = [
        'University of Lagos (UNILAG)',
        'Obafemi Awolowo University (OAU)',
        'University of Ibadan (UI)',
        'Ahmadu Bello University (ABU)',
        'University of Nigeria Nsukka (UNN)',
        'Lagos State University (LASU)',
        'University of Benin (UNIBEN)',
        'Nnamdi Azikiwe University (UNIZIK)',
        'University of Ilorin (UNILORIN)',
        'Federal University of Technology, Akure (FUTA)'
      ];

      // Toggle password visibility
      document.getElementById('togglePassword')?.addEventListener('click', function() {
        const password = document.getElementById('password');
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        this.classList.toggle('fa-eye');
        this.classList.toggle('fa-eye-slash');
      });

      document.getElementById('toggleConfirmPassword')?.addEventListener('click', function() {
        const password = document.getElementById('confirmPassword');
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        this.classList.toggle('fa-eye');
        this.classList.toggle('fa-eye-slash');
      });

      // University search
      const searchInput = document.getElementById('universitySearch');
      const searchResults = document.getElementById('searchResults');

      if (searchInput) {
        searchInput.addEventListener('input', function() {
          const query = this.value.toLowerCase();
          if (query.length < 2) {
            searchResults.classList.remove('show');
            return;
          }

          const filtered = universities.filter(u => u.toLowerCase().includes(query));
          if (filtered.length > 0) {
            searchResults.innerHTML = filtered.map(u => 
              `<div class="search-result-item" onclick="selectUniversity('${u}')">${u}</div>`
            ).join('');
            searchResults.classList.add('show');
          } else {
            searchResults.classList.remove('show');
          }
        });
      }

      // Select university from search
      window.selectUniversity = function(university) {
        userData.university = university;
        document.getElementById('universitySearch').value = university;
        searchResults.classList.remove('show');
      };

      // Popular universities select
      document.getElementById('popularUniversities')?.addEventListener('change', function() {
        if (this.value) {
          userData.university = this.value;
          document.getElementById('universitySearch').value = this.value;
        }
      });

      // Level selection
      document.querySelectorAll('.level-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.level-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          userData.level = this.dataset.level;
        });
      });

      // Navigation functions
      window.goToStep = function(step) {
        updateStep(step);
      };

      function updateStep(step) {
        // Hide all sections
        document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
        document.getElementById(`section${step}`).classList.add('active');

        // Update step tracker
        document.querySelectorAll('.step-item').forEach((item, index) => {
          item.classList.remove('active', 'completed');
          if (index + 1 === step) {
            item.classList.add('active');
          } else if (index + 1 < step) {
            item.classList.add('completed');
            item.querySelector('.step-number').innerHTML = '<i class="fas fa-check"></i>';
          } else {
            item.querySelector('.step-number').innerHTML = index + 1;
          }
        });

        currentStep = step;
      }

      // Validate Step 1
      document.getElementById('nextToUniversity')?.addEventListener('click', function() {
        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!fullName || !email || !password || !confirmPassword) {
          showError('Please fill in all fields');
          return;
        }

        if (password.length < 6) {
          showError('Password must be at least 6 characters');
          return;
        }

        if (password !== confirmPassword) {
          showError('Passwords do not match');
          return;
        }

        userData.fullName = fullName;
        userData.email = email;
        userData.password = password;

        updateStep(2);
      });

      // Step 2 validation
      document.getElementById('nextToDepartment')?.addEventListener('click', function() {
        if (!userData.university) {
          showError('Please select a university');
          return;
        }
        updateStep(3);
      });

      // Step 3 validation
      document.getElementById('nextToLevel')?.addEventListener('click', function() {
        const department = document.getElementById('department').value;
        if (!department) {
          showError('Please select a department');
          return;
        }
        userData.department = department;
        userData.matricNo = document.getElementById('matricNo').value;
        updateStep(4);
      });

      // Step 4 validation
      document.getElementById('nextToReview')?.addEventListener('click', function() {
        if (!userData.level) {
          showError('Please select your current level');
          return;
        }

        // Update review section
        document.getElementById('reviewName').textContent = userData.fullName;
        document.getElementById('reviewEmail').textContent = userData.email;
        document.getElementById('reviewUniversity').textContent = userData.university;
        document.getElementById('reviewDepartment').textContent = userData.department;
        document.getElementById('reviewMatric').textContent = userData.matricNo || 'Not provided';
        document.getElementById('reviewLevel').textContent = `${userData.level} Level`;

        updateStep(5);
      });

      // Back buttons
      document.getElementById('backToAccount')?.addEventListener('click', () => updateStep(1));
      document.getElementById('backToUniversity')?.addEventListener('click', () => updateStep(2));
      document.getElementById('backToDepartment')?.addEventListener('click', () => updateStep(3));
      document.getElementById('backToLevel')?.addEventListener('click', () => updateStep(4));

      // Final submission
      document.getElementById('submitRegistration')?.addEventListener('click', async function() {
        if (!document.getElementById('terms').checked) {
          showError('You must agree to the Terms of Service');
          return;
        }

        const btn = this;
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');

        btn.disabled = true;
        btnText.style.display = 'none';
        btnLoader.style.display = 'inline-block';

        try {
          // Create user in Firebase Auth
          const userCredential = await auth.createUserWithEmailAndPassword(userData.email, userData.password);
          const user = userCredential.user;

          // Update profile
          await user.updateProfile({
            displayName: userData.fullName
          });

          // Create user document in Firestore
          await db.collection('users').doc(user.uid).set({
            fullName: userData.fullName,
            email: userData.email,
            university: userData.university,
            department: userData.department,
            matricNo: userData.matricNo || '',
            level: userData.level,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
            studyStreak: 0,
            totalStudyHours: 0,
            preferences: {
              theme: 'light',
              notifications: true
            }
          });

          // Create study progress
          await db.collection('studyProgress').doc(user.uid).set({
            hours: [0, 0, 0, 0, 0, 0, 0],
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          // Redirect to dashboard
          window.location.href = 'dashboard.html';

        } catch (error) {
          console.error('Registration error:', error);
          
          let errorMsg = 'Registration failed. Please try again.';
          if (error.code === 'auth/email-already-in-use') {
            errorMsg = 'This email is already registered.';
          } else if (error.code === 'auth/weak-password') {
            errorMsg = 'Password is too weak.';
          }
          
          showError(errorMsg);
          
          btn.disabled = false;
          btnText.style.display = 'inline';
          btnLoader.style.display = 'none';
        }
      });

      function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.classList.add('show');
        setTimeout(() => errorDiv.classList.remove('show'), 5000);
      }

      // Check if already logged in
      auth.onAuthStateChanged((user) => {
        if (user) {
          window.location.href = 'dashboard.html';
        }
      });
    })();
  </script>
</body>
</html>